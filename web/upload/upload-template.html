<html>
  <head>
    <script>
      function doSubmit() {
         var xhr = new XMLHttpRequest();
         xhr.onreadystatechange = function() {
            if (xhr.readyState == XMLHttpRequest.DONE) {
               doUploadStep1(JSON.parse(xhr.responseText));
            }
         };
         xhr.open("GET", "{GET_TOKEN_ENDPOINT}", true);
         xhr.send();

         return false;
      }

      function doUploadStep1(authToken) {
         console.log("MOMO", authToken);
         var xhr = new XMLHttpRequest();
         xhr.onreadystatechange = function() {
            if (xhr.readyState == XMLHttpRequest.DONE) {
               doUploadStep2(JSON.parse(xhr.responseText))
            }
         };
         xhr.open("POST", "{UPLOAD_ENDPOINT}", true);
         //xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
         xhr.send(JSON.stringify({objectName: document.file_selector.file.files[0].name, authToken: authToken}));
      }

      function doUploadStep2(requestTemplate) {
         console.log("YOYO", requestTemplate);
         var xhr = new XMLHttpRequest();
         xhr.onreadystatechange = function() {
            if (xhr.readyState == XMLHttpRequest.DONE) {
               alert("SUCCESS");
            }
         };
         xhr.open(requestTemplate.method, requestTemplate.url, true);
         for (var key in requestTemplate.headers) {
            xhr.setRequestHeader(key, requestTemplate.headers[key]);
         }
         xhr.send(document.file_selector.file.files[0]);
      }
    </script>
  </head>
  
  <body>
    <form onsubmit="return doSubmit()" name="file_selector">
      <input type="file" name="file">
      <button type="submit">Submit</button>
    </form>
  </body>
</html>
